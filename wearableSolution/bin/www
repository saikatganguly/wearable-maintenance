#!/usr/bin/env node
var debug = require('debug')('wearableSolution');
var app = require('../app');
var http = require('http').Server(app);
var io = require('socket.io')(http);
var users={};
var client=[];
var i=0; 
io.on('connection', function(socket){
	
	//console.log("Socket connected"); 
	socket.on('broadcastMessage', function(from,name, msg){
		/*client[i]=name;
		i++;
		socket.name=name;
		users[name]=socket;*/
		if(i==0){
			//name='admin'
			client[i]=name;
			socket.name=name;
			users[name]=socket;
			
		}
		else{
			client[i]=name;
			socket.name=name;
			users[name]=socket;
		}
		i++;
		//console.log(" users[name]"+users[name].name); 
		io.emit('broadcastMessage', from, msg,client);
	  });
	socket.on("image", function(data) {
		 
	     if(data.image)
	     {	 data.to='admin';
	     	 users[data.to].emit('image', data.from,data.buffer);
	     }

	 });
	socket.on('disconnect', function(){
		console.log("Socket disconnected"); 
	});

});


 
// Listen application request on port 3000
http.listen(3000, function(){
  console.log('listening on *:3000');
});



/*app.set('port', process.env.PORT || 3000);

var server = app.listen(app.get('port'), function() {
  debug('Express server listening on port ' + server.address().port);
});*/
